<style>
  .mr-wrap{--ink:#111;--hair:#c9c9c9;--border:#222;
           font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .mr-wrap h2{margin:0 0 .4rem;font-size:20px}

  /* toolbar (search on the right) */
  .mr-toolbar{
    display:flex; justify-content:flex-end; align-items:center;
    gap:.6rem; margin:.35rem 0 .6rem;
  }
  .mr-search{ position:relative; width:min(360px, 100%); }
  .mr-search input{
    width:100%; height:2.2rem; padding:.45rem 2.2rem .45rem .65rem;
    border:1px solid var(--hair); border-radius:4px; outline:none;
  }
  .mr-search svg{
    position:absolute; right:.5rem; top:50%; transform:translateY(-50%);
    width:18px; height:18px; opacity:.7; pointer-events:none;
  }

  /* scrollable table wrapper + sticky header */
  .mr-table-wrap{
    border:1px solid var(--border);
    overflow-y:auto; overflow-x:auto; overscroll-behavior:contain;
    max-height:60vh; background:#fff;
  }
  .mr-table{width:100%;border-collapse:separate;border-spacing:0;min-width:1500px;background:#fff}
  .mr-table thead{background:#f7f7f7}
  .mr-table thead th{position:sticky; top:0; z-index:2; background:#f7f7f7}

  .mr-table th,.mr-table td{padding:.55rem .65rem;text-align:left}
  .mr-table th{border-bottom:1px solid var(--border);font-weight:600}
  .mr-table td{border-top:1px solid var(--hair)}

  /* vertical column separators */
  .mr-table th, .mr-table td{ border-right:1px solid var(--hair); }
  .mr-table th:last-child, .mr-table td:last-child{ border-right:none; }

  .actions-col{width:170px}
  .actions-cell{white-space:nowrap}
  .actions-cell .mr-edit,
  .actions-cell .mr-del,
  .actions-cell .mr-save,
  .actions-cell .mr-cancel{
    padding:.35rem .6rem;border:1px solid var(--hair);background:#fff;cursor:pointer;margin-right:.35rem
  }
  .actions-cell .mr-del{border-color:#d5a3a3}
  .actions-cell .mr-save{background:#222;color:#fff;border-color:#222}
  .actions-cell .mr-cancel{background:#f7f7f7}

  /* Inputs used in inline editing */
  .mr-inline{
    border:1px solid var(--hair); padding:.35rem .5rem; width:100%;
    font:inherit; height:2.1rem;
  }
  .mr-inline-select{height:2.1rem}

  /* Mobile: stack rows and show labels */
  @media (max-width:560px){
    .mr-table{min-width:0}
    .mr-table thead{display:none}
    .mr-table tr{display:grid;grid-template-columns:1fr;gap:.45rem;
      border-top:1px solid var(--hair);padding:.6rem .6rem}
    .mr-table td{border:0;padding:0}
    .mr-table td::before{
      content: attr(data-label);
      display:block; font-size:.8rem; color:#555; margin-bottom:.15rem; font-weight:600;
      position:relative; padding-left:.6rem;
    }
    .mr-table td::before::after{
      content:""; position:absolute; left:0; top:0.1rem; bottom:0.1rem;
      width:2px; background:#e0e0e0;
    }
    .actions-cell{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.25rem}
    .actions-cell button{flex:1;min-width:110px}
  }

  /* Print */
  @media print{
    .mr-toolbar{display:none}
    .mr-table-wrap{max-height:none !important; overflow:visible !important; border:1px solid #000}
    .mr-table th{border-bottom:1px solid #000;background:#efefef}
    .mr-table td{border-top:1px solid #999}
    .mr-table th, .mr-table td{ border-right:1px solid #999; }
    .mr-table th:last-child, .mr-table td:last-child{ border-right:none; }
    .actions-col,.actions-cell{display:none}
  }
</style>

<!-- Marriage Records (DB-driven, with Edit/Delete + Search) -->
<section id="marriage-records" class="mr-wrap">
  <h2>Marriage Records</h2>

  <!-- Right-aligned search -->
  <div class="mr-toolbar">
    <label class="mr-search" aria-label="Search marriage records">
      <input id="mr-search" type="search" placeholder="Search" />
      <!-- magnifying glass icon -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
      </svg>
    </label>
  </div>

  <div class="mr-table-wrap">
    <table class="mr-table" aria-label="Marriage Records">
      <thead>
        <tr>
          <th>Full Name (Groom)</th>
          <th>Full Name (Bride)</th>
          <th>Date of Birth (Groom)</th>
          <th>Date of Birth (Bride)</th>
          <th>Sex (Groom)</th>
          <th>Sex (Bride)</th>
          <th>Citizenship (Groom)</th>
          <th>Citizenship (Bride)</th>
          <th>Residence (Groom)</th>
          <th>Residence (Bride)</th>
          <th>Religion (Groom)</th>
          <th>Religion (Bride)</th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody id="mr-body">
        <!-- Seed rows (replace with server-rendered rows) -->
        <tr data-id="801">
          <td data-label="Full Name (Groom)">Juan Dela Cruz</td>
          <td data-label="Full Name (Bride)">Maria Santos</td>
          <td data-label="Date of Birth (Groom)">1992-03-05</td>
          <td data-label="Date of Birth (Bride)">1994-07-18</td>
          <td data-label="Sex (Groom)">Male</td>
          <td data-label="Sex (Bride)">Female</td>
          <td data-label="Citizenship (Groom)">Filipino</td>
          <td data-label="Citizenship (Bride)">Filipino</td>
          <td data-label="Residence (Groom)">Quezon City, NCR</td>
          <td data-label="Residence (Bride)">Quezon City, NCR</td>
          <td data-label="Religion (Groom)">Roman Catholic</td>
          <td data-label="Religion (Bride)">Roman Catholic</td>
          <td class="actions-cell" data-label="Actions">
            <button class="mr-edit">Edit</button>
            <button class="mr-del">Delete</button>
          </td>
        </tr>
        <tr data-id="802">
          <td data-label="Full Name (Groom)">Ramon Ortega</td>
          <td data-label="Full Name (Bride)">Lara Mendoza</td>
          <td data-label="Date of Birth (Groom)">1988-11-22</td>
          <td data-label="Date of Birth (Bride)">1990-01-09</td>
          <td data-label="Sex (Groom)">Male</td>
          <td data-label="Sex (Bride)">Female</td>
          <td data-label="Citizenship (Groom)">Filipino</td>
          <td data-label="Citizenship (Bride)">Filipino</td>
          <td data-label="Residence (Groom)">Cebu City, Cebu</td>
          <td data-label="Residence (Bride)">Cebu City, Cebu</td>
          <td data-label="Religion (Groom)">Iglesia ni Cristo</td>
          <td data-label="Religion (Bride)">Iglesia ni Cristo</td>
          <td class="actions-cell" data-label="Actions">
            <button class="mr-edit">Edit</button>
            <button class="mr-del">Delete</button>
          </td>
        </tr>
      </tbody>
      <tbody id="mr-empty" style="display:none">
        <tr><td colspan="13" style="padding:.8rem .65rem;color:#666">No matching records.</td></tr>
      </tbody>
    </table>
  </div>
</section>

<script>
  // Inline edit / delete + search filter (Marriage Records, split per party)
  (function(){
    const tbody = document.getElementById('mr-body');
    const empty = document.getElementById('mr-empty');
    const search = document.getElementById('mr-search');

    function escAttr(s){ return (s||'').replace(/"/g,'&quot;'); }

    function rowToEdit(tr){
      const [
        gNameTd, bNameTd, gDobTd, bDobTd,
        gSexTd,  bSexTd,  gCitTd, bCitTd,
        gResTd,  bResTd,  gRelTd, bRelTd,
        actTd
      ] = tr.children;

      // Save originals
      tr.dataset.origGname = gNameTd.textContent.trim();
      tr.dataset.origBname = bNameTd.textContent.trim();
      tr.dataset.origGdob  = gDobTd.textContent.trim();
      tr.dataset.origBdob  = bDobTd.textContent.trim();
      tr.dataset.origGsex  = gSexTd.textContent.trim();
      tr.dataset.origBsex  = bSexTd.textContent.trim();
      tr.dataset.origGcit  = gCitTd.textContent.trim();
      tr.dataset.origBcit  = bCitTd.textContent.trim();
      tr.dataset.origGres  = gResTd.textContent.trim();
      tr.dataset.origBres  = bResTd.textContent.trim();
      tr.dataset.origGrel  = gRelTd.textContent.trim();
      tr.dataset.origBrel  = bRelTd.textContent.trim();

      // Inputs
      gNameTd.innerHTML = `<input class="mr-inline" name="groom_name" value="${escAttr(tr.dataset.origGname)}" required>`;
      bNameTd.innerHTML = `<input class="mr-inline" name="bride_name" value="${escAttr(tr.dataset.origBname)}" required>`;

      gDobTd.innerHTML  = `<input class="mr-inline" type="date" name="dob_groom" value="${escAttr(tr.dataset.origGdob)}" required>`;
      bDobTd.innerHTML  = `<input class="mr-inline" type="date" name="dob_bride" value="${escAttr(tr.dataset.origBdob)}" required>`;

      gSexTd.innerHTML  = `
        <select class="mr-inline mr-inline-select" name="sex_groom" required>
          <option ${tr.dataset.origGsex===''?'selected':''} value="" disabled>—</option>
          <option ${tr.dataset.origGsex==='Male'?'selected':''}>Male</option>
          <option ${tr.dataset.origGsex==='Female'?'selected':''}>Female</option>
        </select>`;
      bSexTd.innerHTML  = `
        <select class="mr-inline mr-inline-select" name="sex_bride" required>
          <option ${tr.dataset.origBsex===''?'selected':''} value="" disabled>—</option>
          <option ${tr.dataset.origBsex==='Male'?'selected':''}>Male</option>
          <option ${tr.dataset.origBsex==='Female'?'selected':''}>Female</option>
        </select>`;

      gCitTd.innerHTML  = `<input class="mr-inline" name="cit_groom" value="${escAttr(tr.dataset.origGcit)}" required>`;
      bCitTd.innerHTML  = `<input class="mr-inline" name="cit_bride" value="${escAttr(tr.dataset.origBcit)}" required>`;

      gResTd.innerHTML  = `<input class="mr-inline" name="res_groom" value="${escAttr(tr.dataset.origGres)}" required>`;
      bResTd.innerHTML  = `<input class="mr-inline" name="res_bride" value="${escAttr(tr.dataset.origBres)}" required>`;

      gRelTd.innerHTML  = `<input class="mr-inline" name="rel_groom" value="${escAttr(tr.dataset.origGrel)}" required>`;
      bRelTd.innerHTML  = `<input class="mr-inline" name="rel_bride" value="${escAttr(tr.dataset.origBrel)}" required>`;

      actTd.innerHTML = `<button class="mr-save">Save</button><button class="mr-cancel">Cancel</button>`;
      tr.classList.add('editing');
      gNameTd.querySelector('input').focus();
    }

    function rowCancelEdit(tr){
      const [
        gNameTd, bNameTd, gDobTd, bDobTd,
        gSexTd,  bSexTd,  gCitTd, bCitTd,
        gResTd,  bResTd,  gRelTd, bRelTd,
        actTd
      ] = tr.children;

      gNameTd.textContent = tr.dataset.origGname;
      bNameTd.textContent = tr.dataset.origBname;
      gDobTd.textContent  = tr.dataset.origGdob;
      bDobTd.textContent  = tr.dataset.origBdob;
      gSexTd.textContent  = tr.dataset.origGsex;
      bSexTd.textContent  = tr.dataset.origBsex;
      gCitTd.textContent  = tr.dataset.origGcit;
      bCitTd.textContent  = tr.dataset.origBcit;
      gResTd.textContent  = tr.dataset.origGres;
      bResTd.textContent  = tr.dataset.origBres;
      gRelTd.textContent  = tr.dataset.origGrel;
      bRelTd.textContent  = tr.dataset.origBrel;

      actTd.innerHTML     = `<button class="mr-edit">Edit</button><button class="mr-del">Delete</button>`;
      tr.classList.remove('editing');
    }

    function rowSaveEdit(tr){
      const [
        gNameTd, bNameTd, gDobTd, bDobTd,
        gSexTd,  bSexTd,  gCitTd, bCitTd,
        gResTd,  bResTd,  gRelTd, bRelTd
      ] = tr.children;

      const payload = {
        groom_name: gNameTd.querySelector('input').value.trim(),
        bride_name: bNameTd.querySelector('input').value.trim(),
        dob_groom:  gDobTd.querySelector('input').value,
        dob_bride:  bDobTd.querySelector('input').value,
        sex_groom:  gSexTd.querySelector('select').value,
        sex_bride:  bSexTd.querySelector('select').value,
        cit_groom:  gCitTd.querySelector('input').value.trim(),
        cit_bride:  bCitTd.querySelector('input').value.trim(),
        res_groom:  gResTd.querySelector('input').value.trim(),
        res_bride:  bResTd.querySelector('input').value.trim(),
        rel_groom:  gRelTd.querySelector('input').value.trim(),
        rel_bride:  bRelTd.querySelector('input').value.trim()
      };

      if(Object.values(payload).some(v => !v)){
        alert('Please fill all fields.');
        return;
      }

      // TODO: call your backend update API, e.g.:
      // fetch('/api/marriage-records/'+tr.dataset.id, {
      //   method:'PUT', headers:{'Content-Type':'application/json'},
      //   body:JSON.stringify(payload)
      // })

      // Update UI with saved values then exit edit mode
      tr.dataset.origGname = payload.groom_name;
      tr.dataset.origBname = payload.bride_name;
      tr.dataset.origGdob  = payload.dob_groom;
      tr.dataset.origBdob  = payload.dob_bride;
      tr.dataset.origGsex  = payload.sex_groom;
      tr.dataset.origBsex  = payload.sex_bride;
      tr.dataset.origGcit  = payload.cit_groom;
      tr.dataset.origBcit  = payload.cit_bride;
      tr.dataset.origGres  = payload.res_groom;
      tr.dataset.origBres  = payload.res_bride;
      tr.dataset.origGrel  = payload.rel_groom;
      tr.dataset.origBrel  = payload.rel_bride;

      rowCancelEdit(tr);
      runFilter();
    }

    function rowDelete(tr){
      if(confirm('Delete this record?')){
        // TODO: fetch('/api/marriage-records/'+tr.getAttribute('data-id'), {method:'DELETE'}).then(()=> tr.remove());
        tr.remove();
        runFilter();
      }
    }

    tbody.addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return;
      const tr = e.target.closest('tr'); if(!tr) return;
      if(btn.classList.contains('mr-edit')) rowToEdit(tr);
      else if(btn.classList.contains('mr-cancel')) rowCancelEdit(tr);
      else if(btn.classList.contains('mr-save')) rowSaveEdit(tr);
      else if(btn.classList.contains('mr-del')) rowDelete(tr);
    });

    // ------- Live Search across first 12 columns -------
    const tableBody = document.getElementById('mr-body');
    function runFilter(){
      const q = (search.value || '').trim().toLowerCase();
      let shown = 0;
      [...tableBody.querySelectorAll('tr')].forEach(tr=>{
        const cells = [...tr.querySelectorAll('td')].slice(0,12); // skip actions col
        const hay = cells.map(td=>td.textContent.toLowerCase()).join(' ');
        const match = hay.includes(q);
        tr.style.display = match ? '' : 'none';
        if(match) shown++;
      });
      empty.style.display = shown === 0 ? '' : 'none';
    }
    search.addEventListener('input', runFilter);
    runFilter(); // initial
  })();
</script>
