<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="/LCRSystem/image/LCRlogo.png" type="image/png" sizes="32x32">
<link rel="apple-touch-icon" href="/LCRSystem/image/LCRlogo.png">
<meta name="theme-color" content="#415D8A">
<title>Birth Certificate Registration – Requirements</title>
<style>
  :root{
    --blue-50:#eef6ff; --blue-100:#dbeafe; --blue-200:#bfdbfe; --blue-400:#60a5fa; --blue-700:#1d4ed8;
    --slate-50:#f8fafc; --slate-200:#e2e8f0; --slate-400:#94a3b8; --slate-600:#475569; --slate-700:#334155;
    --white:#fff; --text:#0f172a;
    --bar-h:66px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:#f3f6fb;color:var(--text);font:14px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .container{max-width:900px;margin:28px auto;padding:20px}
  .sheet{background:var(--white);border:1px solid var(--blue-200);border-radius:12px;box-shadow:0 6px 22px rgba(65,93,138,.12);overflow:hidden}
  .header{background:var(--blue-100);border-bottom:1px solid var(--blue-200);padding:18px 22px;display:flex;align-items:center;gap:14px;flex-wrap:wrap}
  .header h1{margin:0;font-size:18px;letter-spacing:.2px;color:var(--blue-700);font-weight:800;flex:1}
  .badge{padding:6px 10px;border:1px solid var(--blue-200);border-radius:999px;font-size:12px;color:var(--blue-700);background:#fff}
  .section{padding:18px 22px;border-bottom:1px dashed #c9d5ea}
  .section:last-child{border-bottom:0}
  .section h2{margin:0 0 10px;font-size:15px;color:var(--blue-700);text-transform:uppercase;letter-spacing:.6px}
  .grid{display:grid;gap:12px}
  .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  .grid.cols-2{grid-template-columns:repeat(2,1fr)}
  label.small{font-size:11px;letter-spacing:.3px;color:#3b4a63;text-transform:uppercase}
  input[type="text"], select, textarea, input[type="date"]{width:100%;padding:10px 12px;border:1px solid #cbd5e1;border-radius:8px;background:#fff;outline:none}
  



.legend {
  display: flex;
  flex-wrap: wrap;         /* allow multiple lines */
  justify-content: center; /* center whole block */
  gap: 10px;
  margin: 15px 0;
}

.pills {
  display: inline-flex;
  align-items: center;     
  justify-content: center;
  padding: 8px 14px;
  border: 1px solid #ccc;
  border-radius: 20px;
  font-size: 14px;
  background: #fff;
  color: #333;
  transition: all 0.3s ease;
  text-align: center;
  white-space: normal;     
  word-break: break-word;   
  max-width: 220px;         
  line-height: 1.4;
}

/* Hover states */
.pills:hover {
  cursor: pointer;
  background: #f0f4ff;
  color: #0a0eca;
  border-color: #0a0eca;
}

  
  
  
  
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #cbd5e1;border-radius:999px;font-size:12px;color:#0f172a;background:#fff}

  /* ---------- TABLE ---------- */
  .checklist{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #cbd5e1;border-radius:10px;overflow:hidden}
  .checklist thead th{background:var(--blue-100);border-bottom:1px solid var(--blue-200);font-size:12px;color:#2d3e5c;text-transform:uppercase;letter-spacing:.4px;padding:10px}
  .checklist tbody tr:nth-child(even){background:var(--slate-50)}
  .checklist td{padding:10px;border-bottom:1px dashed #e2e8f0;vertical-align:top}
  .checklist td:first-child{width:32px;text-align:center}
  .req-title{font-weight:700}
  .subtext{font-size:12px;color:var(--slate-600);margin-top:2px}

  .sheet-actions{display:flex; gap:10px; align-items:center;padding:10px 22px; border-top:1px dashed #c9d5ea}
  .action-btn{flex:0 0 auto;display:inline-flex;align-items:center;gap:8px;border-radius:999px;border:1px solid #cbd5e1;background:#fff;color:#0f172a;padding:10px 14px;text-decoration:none;font-weight:700;box-shadow:0 6px 18px rgba(15,23,42,.08)}
  .action-btn.primary{background:var(--blue-700);color:#fff;border-color:#2c476e}
  .action-btn.is-disabled{opacity:.55;cursor:not-allowed;pointer-events:none}

   @media (max-width: 760px) {
  .checklist thead { display: none; }

  .checklist {
    border: 0;            /* the card will have its own border */
    border-radius: 0;
  }

  .checklist tbody,
  .checklist tr,
  .checklist td {
    display: block;
    width: 100%;
  }

  .checklist tbody tr {
    margin: 12px 0;
    border: 1px solid #cbd5e1;
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 4px 14px rgba(15,23,42,.05);
    overflow: hidden;
  }

  .checklist tbody tr:nth-child(even){ background:#fff; } /* disable zebra in card mode */

  .checklist td {
    border: 0;
    padding: 12px 14px;
    border-bottom: 1px dashed #e2e8f0;
  }
  .checklist td:last-child { border-bottom: 0; }

  /* First cell (Done) left aligned */
  .checklist td:first-child {
    width: auto;
    text-align: left;
  }

  /* Add mini labels for each stacked cell */
  .checklist td[data-label]::before{
    content: attr(data-label);
    display: block;
    font-size: 11px;
    color: var(--slate-600);
    text-transform: uppercase;
    letter-spacing: .3px;
    margin-bottom: 6px;
  }

  /* Make the uploader breathe on mobile */
  .uploader { padding: 14px; }
  .uploader .top { min-height: auto; }
  .uploader .progress { width: 100%; min-width: 0; }
}


  /* ---------- NEW UPLOADER (matches 2nd image) ---------- */
  .uploader{
    width:100%;
    border:2px dashed var(--slate-400);
    border-radius:12px;
    padding:16px;
    background:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    text-align:center;
    position:relative;
  }
  .uploader.dragover{background:var(--blue-50);border-color:var(--blue-400)}
  .uploader .top{
    width:100%;
    min-height:120px;
    border:2px dashed transparent; /* purely for spacing similarity */
    border-radius:10px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    gap:8px;
  }
  .uploader .title{font-weight:700;font-size:18px}
  .uploader .sub{color:var(--slate-600)}
  .uploader .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center}
  .uploader input[type="file"]{display:inline-block}
  .uploader .filename{font-size:12px;color:var(--slate-700)}
  .uploader .progress{
    width:60%;max-width:460px;min-width:220px;height:14px;border-radius:999px;background:#e5e7eb;position:relative;overflow:hidden
  }
  .uploader .bar{position:absolute;left:0;top:0;bottom:0;width:0%;background:var(--blue-700)}
  .uploader .pct{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff}
  .uploader .upload-btn{display:inline-flex;align-items:center;gap:8px;border-radius:8px;border:1px solid #1e40af;background:var(--blue-700);color:#fff;padding:10px 16px;font-weight:700;cursor:pointer}
  .uploader .upload-btn[disabled]{opacity:.6;cursor:not-allowed}
  .uploader .hint{font-size:12px;color:var(--slate-600)}
  .status-badge{font-size:12px;border:1px solid #cbd5e1;border-radius:999px;padding:4px 8px;background:#fff;color:#0f172a}
  .status-badge.ok{border-color:#16a34a;color:#065f46}
  .status-badge.warn{border-color:#f59e0b;color:#92400e}

  @media (max-width:820px){ .container{padding:14px} .grid.cols-3{grid-template-columns:1fr 1fr} }
  @media (max-width:640px){
    .uploader .progress{width:100%}
    .uploader .row{flex-direction:column}
  }

  .mini-btn{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px; font-size:12px;
  background:#fff; border:1px solid #cbd5e1; color:#0f172a; cursor:pointer;
}
.mini-btn:disabled{opacity:.6; cursor:not-allowed}
.mini-btn.reupload{border-color:#1e40af; color:#1e40af}
.mini-btn.view{border-color:#16a34a; color:#065f46}
.mini-btn + .mini-btn{margin-left:6px}

.mini-btn.reupload:hover {
  background: #e6ecff;      /* light blue background (optional) */
  color: #0a0eca;           /* blue text on hover */
  border-color: #0a0eca;
}

.mini-btn.view:hover {
  background: #e8f8ee;      /* light green background (optional) */
  color: #16a34a;           /* green text on hover */
  border-color: #16a34a;
}

/* universal hover pointer */
.mini-btn:hover {
  cursor: pointer;
}





 /* one-line actions: Uploaded | Reupload | View */
.upload-actions{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;
  justify-content:center; /* or flex-start if you prefer left aligned */
  margin-top:4px;
}
.upload-actions .status-badge{display:inline-flex}


.sheet-actions {
  display: flex;
  justify-content: center;     /* center group */
  align-items: center;
  gap: 20px;                   /* spacing between buttons */
  padding: 12px 22px;
  flex-wrap: nowrap;           /* force them on one line */
}

/* base button look */
.sheet-actions .action-btn {
  flex: 0 0 auto;
  text-align: center;
  white-space: nowrap;
  padding: 12px 20px;
  font-size: 14px;
  border-radius: 999px;
  font-weight: 600;
}

/* make Submit green */
#submitAll {
  background: #16a34a;      /* green */
  color: #fff;
  border: 1px solid #15803d;
}
#submitAll.is-disabled {
  background: #e2e8f0;      /* light gray when disabled */
  border-color: #cbd5e1;
  color: #64748b;
}

/* already have .primary for Proceed (blue) */

/* responsive sizing */
@media (max-width: 520px) {
  .sheet-actions {
    gap: 12px;
  }
  .sheet-actions .action-btn {
    font-size: 12px;
    padding: 8px 14px;   /* smaller buttons on mobile */
  }
}

 .section.signoff{padding:18px 22px}
  .sig-header{
    display:flex; align-items:flex-end; justify-content:space-between; gap:20px;
    margin-bottom:24px; font-size:14px;
  }
  .sig-header .date{display:flex; align-items:flex-end; gap:8px; white-space:nowrap}
  .sig-header .date-line{display:inline-block; min-width:220px; height:18px; border-bottom:1px solid #0f172a}

  .sig-grid{display:grid; grid-template-columns:1fr 1fr; gap:40px}
  .sig-block .signature-line{height:38px; border-bottom:1px solid #0f172a; margin-bottom:6px}
  .sig-name{font-weight:800; letter-spacing:.4px}
  .sig-title{font-size:12px; color:#334155}
  @media (max-width:640px){
    .sig-grid{grid-template-columns:1fr; gap:22px}
    .sig-header .date-line{min-width:160px}
  }

   .sig-block{position:relative}
  .signature-line{
    position:relative;
    height:62px;                 /* taller for a visible signature */
    border-bottom:1px solid #0f172a;
    margin-bottom:6px;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }
  .signature-line img{
    max-height:58px; max-width:100%;
    object-fit:contain; pointer-events:none;
  }
  .sig-pad{
    border:1px dashed #94a3b8;
    border-radius:8px; background:#fff;
    height:130px; width:100%;
    touch-action:none;           /* smooth touch drawing */
  }
  .sig-tools{
    display:flex; gap:10px; align-items:center; justify-content:flex-end;
    margin-top:8px;
  }
  .sig-btn{
    font-size:12px; padding:6px 10px; border-radius:999px;
    border:1px solid #cbd5e1; background:#fff; color:#0f172a; cursor:pointer;
  }
  .sig-btn.primary{border-color:#1e40af; color:#1e40af}
  .sig-header .date .date-line{
    border-bottom:1px solid #0f172a; padding-bottom:2px; min-width:220px;
  }
  @media (max-width:640px){
    .signature-line{height:56px}
    .sig-pad{height:120px}
  }
</style>
</head>
<body>

  <div class="container">
    <!-- Sheet 1 -->
    <div class="sheet">
      <div class="header">
        <h1>Local Civil Registry Office Buenavista, Agusan del Norte</h1>
        <span class="badge">REGULAR FILING OF REQUIREMENTS FOR CERTIFICATE OF DEATH Timely Registration</span>
      </div>

      <div class="section" id="owner-section">
        <h2>Document Owner</h2>
        <div class="grid cols-3">
          <div>
            <label class="small" for="lastName">Last Name</label>
            <input id="lastName" name="lastName" type="text" autocomplete="family-name" />
          </div>
          <div>
            <label class="small" for="firstName">First Name</label>
            <input id="firstName" name="firstName" type="text" autocomplete="given-name" />
          </div>
          <div>
            <label class="small" for="middleName">Middle Name</label>
            <input id="middleName" name="middleName" type="text" />
          </div>
        </div>
  
    
    </div>

    <!-- Sheet 2 -->
    <div class="sheet" id="timely-section" style="margin-top:20px">
      <div class="header"><h1>Timely (Regular) Registration of Birth</h1></div>

      <label class="pill" style="margin:12px 22px 0;border-left:4px solid var(--blue-700)">
        Note: Upload the required documents (in any order). Each item is marked complete after a successful upload. The Proceed button is enabled only when all required uploads for your case are complete.
      </label>

      <div class="legend">
         
          <span class="pills">Click Reuplod to change the File/Image</span>
          <span class="pills">Click View to see what you uploaded</span>
          <span class="pills">Click Upload to confirm or drag & drop to auto-upload</span>
        </div>
      </div>

      <div class="section">
        <table class="checklist">
          <thead>
          <tr><th style="width:32px">Done</th><th>Requirement</th><th>Upload</th></tr>
          </thead>
          <tbody id="timelyBody">

              
            <!-- 1 -->
            <tr data-req="marriageCert" data-required-when="marital">
              <td><input type="checkbox" aria-label="Completed" disabled></td>
              <td>
                <div class="req-title">1.Barangay Certification</div>
                <div class="subtext">Required only if parents are married.</div>
              </td>
              <td>
                <div class="uploader" data-dropzone>
                  <div class="top">
                    <div class="title">Please drag an image or file</div>
                    <div class="row">
                      <input type="file" accept=".pdf,.jpg,.jpeg,.png" aria-label="Choose file">
                      <br>
                      <span class="filename" data-fn></span>
                    </div>
                    <div class="sub">Drop file(s) here or click to browse</div>
                      <br>
                  </div>
                  <div class="progress" hidden>
                    <div class="bar"></div><div class="pct" data-pct>0%</div>
                  </div>
                  <button class="upload-btn" type="button" hidden>Upload</button>
                  <span class="status-badge warn" hidden>Uploading…</span>
                  <span class="status-badge ok" hidden>pending</span>
                </div>
              </td>
            </tr>



             <!-- 2 -->
            <tr data-req="barangayCert" data-always-required="true">
              <td><input type="checkbox" aria-label="Completed" disabled></td>
              <td>
                <div class="req-title">2.Police/NBI Report</div>
                <div class="subtext">Residence/birth attestation as required by the LGU.</div>
              </td>
              <td>
                <div class="uploader" data-dropzone>
                  <div class="top">
                    <div class="title">Please drag an image or file</div>
                    <div class="row">
                      <input type="file" accept=".pdf,.jpg,.jpeg,.png" aria-label="Choose file">
                      <br>
                      <span class="filename" data-fn></span>
                    </div>
                    <div class="sub">Drop file(s) here or click to browse</div>
                      <br>
                  </div>
                  <div class="progress" hidden>
                    <div class="bar"></div><div class="pct" data-pct>0%</div>
                  </div>
                  <button class="upload-btn" type="button" hidden>Upload</button>
                  <span class="status-badge warn" hidden>Uploading…</span>
                  <span class="status-badge ok" hidden>Uploaded</span>
                </div>
              </td>
            </tr>


            <!-- 3 -->
            <tr data-req="parentIDs" data-always-required="true">
              <td><input type="checkbox" aria-label="Completed" disabled></td>
              <td>
                <div class="req-title">3.Cause of Death issued by MHO</div>
                <div class="subtext">Any government-issued ID of mother and/or father.</div>
              </td>
              <td>
                <div class="uploader" data-dropzone>
                  <div class="top">
                    <div class="title">Please drag an image or file</div>
                    <div class="row">
                      <input type="file" accept=".pdf,.jpg,.jpeg,.png" multiple aria-label="Choose files">
                      <br>
                      <span class="filename" data-fn></span>
                    </div>
                    <div class="sub">Drop file(s) here or click to browse</div>
                      <br>
                  </div>
                  <div class="progress" hidden>
                    <div class="bar"></div><div class="pct" data-pct>0%</div>
                  </div>
                  <button class="upload-btn" type="button" hidden>Upload</button>
                  <span class="status-badge warn" hidden>Uploading…</span>
                  <span class="status-badge ok" hidden>Uploaded</span>
                  <div class="hint">Upload front & back if applicable</div>
                </div>
              </td>
            </tr>


        
          </tbody>
        </table>
      </div>


     <div class="sheet" id="signoff" style="margin-top:20px">
  <div class="section signoff">
    <div class="sig-header">
      <span>Checked and Verified by:</span>
      <span class="date">Date: <span class="date-line" id="todayDate"></span></span>
    </div>

    <div class="sig-grid">
      <!-- 1st signature block -->
      <div class="sig-block" data-sig="joanne">
        <div class="signature-line">
          <img alt="Signature preview" id="sigImg-joanne">
        </div>

        <canvas class="sig-pad" id="sigPad-joanne"></canvas>
        <div class="sig-tools">
          <button type="button" class="sig-btn" data-clear="joanne">Clear</button>
          <button type="button" class="sig-btn primary" data-accept="joanne">Use Signature</button>
        </div>

        <div class="sig-name">JOANNE A. PAL</div>
        <div class="sig-title">Admin Officer V – LCRO – BTA. ADN</div>
      </div>

      <!-- 2nd signature block -->
      <div class="sig-block" data-sig="teresita">
        <div class="signature-line">
          <img alt="Signature preview" id="sigImg-teresita">
        </div>

        <canvas class="sig-pad" id="sigPad-teresita"></canvas>
        <div class="sig-tools">
          <button type="button" class="sig-btn" data-clear="teresita">Clear</button>
          <button type="button" class="sig-btn primary" data-accept="teresita">Use Signature</button>
        </div>

        <div class="sig-name">TERESITA K. VALDEHUEZA</div>
        <div class="sig-title">Municipal Civil Registrar – LCRO – BTA. ADN</div>
      </div>
    </div>
  </div>
</div>




  <nav class="sheet-actions" aria-label="Timely actions">
  <button id="submitAll" class="action-btn is-disabled" disabled>
    Submit Requirements
  </button>

  <a class="action-btn primary is-disabled" id="proceedAction"
     href="birthRegistration.html" aria-disabled="true" tabindex="-1">
    Proceed to Birth Registration
  </a>
</nav>

    </div>
  </div>

<script>
  const MAX_MB = 10;
  const tooBig = (file) => file.size > MAX_MB*1024*1024;

  function annotateChecklistLabels(){
    const table = document.querySelector('.checklist');
    if(!table) return;
    const heads = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(tr => {
      const tds = tr.querySelectorAll('td');
      tds.forEach((td, i) => {
        if (heads[i]) td.setAttribute('data-label', heads[i]);
      });
    });
  }

  // call it early so CSS has labels available on small screens
  annotateChecklistLabels();

  function setRowFiles(row, files){
    if (row._blobUrls && Array.isArray(row._blobUrls)) {
      row._blobUrls.forEach(u => { try { URL.revokeObjectURL(u); } catch(e){} });
    }
    row._uploadedFiles = Array.from(files || []);
    row._blobUrls = row._uploadedFiles.map(f => URL.createObjectURL(f));
  }

  function ensureActionButtons(row){
    const dz = row.querySelector('[data-dropzone]');
    const uploadedBadge = dz.querySelector('.status-badge.ok');
    if(!uploadedBadge) return;

    let actions = dz.querySelector('.upload-actions');
    if(!actions){
      actions = document.createElement('div');
      actions.className = 'upload-actions';
      uploadedBadge.insertAdjacentElement('afterend', actions);
      actions.appendChild(uploadedBadge);
    }

    let reBtn = row.querySelector('.mini-btn.reupload');
    let viewBtn = row.querySelector('.mini-btn.view');

    if(!reBtn){
      reBtn = document.createElement('button');
      reBtn.type = 'button';
      reBtn.className = 'mini-btn reupload';
      reBtn.textContent = 'Reupload';
      actions.appendChild(reBtn);

      reBtn.addEventListener('click', () => {
        const input = dz.querySelector('input[type="file"]');
        const fnEl  = dz.querySelector('[data-fn]');
        input.disabled = false;
        input.value = '';
        const oneShot = () => {
          if(input.files && input.files.length){
            fnEl.textContent = Array.from(input.files).map(f=>f.name).join(', ');
            simulateUpload(row, input.files);
          }
        };
        input.addEventListener('change', oneShot, { once: true });
        input.click();
      });
    }

    if(!viewBtn){
      viewBtn = document.createElement('button');
      viewBtn.type = 'button';
      viewBtn.className = 'mini-btn view';
      viewBtn.textContent = 'View';
      actions.appendChild(viewBtn);

      viewBtn.addEventListener('click', () => {
        if(!row._blobUrls || !row._blobUrls.length){
          alert('No file available to view.');
          return;
        }
        window.open(row._blobUrls[0], '_blank');
      });
    }
  }

  // Safely read the status value (or empty string if the dropdown doesn't exist)
  function getStatus() {
    const el = document.getElementById('status');
    return el ? el.value : '';
  }

  function isRowRequired(row){
    if (row.dataset.alwaysRequired === 'true') return true;
    const need = row.dataset.requiredWhen;
    if (!need) return false;
    return getStatus() === need;
  }

  function updateRowVisualRequiredness(){
    document.querySelectorAll('#timelyBody tr').forEach(row=>{
      const t = row.querySelector('.req-title');
      if(isRowRequired(row)){
        t.style.textDecoration = 'none';
        t.title = 'Required for this case';
      }else{
        t.style.textDecoration = 'underline dotted';
        t.title = 'Not required for this case';
      }
    });
  }

  function updateProceedState(){
    const rows = Array.from(document.querySelectorAll('#timelyBody tr'));
    const allRequiredCompleted = rows.every(row => !isRowRequired(row) || row.dataset.completed === 'true');

    const proceed = document.getElementById('proceedAction');
    const submitBtn = document.getElementById('submitAll');

    if(allRequiredCompleted){
      proceed.classList.remove('is-disabled');
      proceed.removeAttribute('aria-disabled');
      proceed.removeAttribute('tabindex');

      submitBtn.classList.remove('is-disabled');
      submitBtn.disabled = false;
    }else{
      proceed.classList.add('is-disabled');
      proceed.setAttribute('aria-disabled','true');
      proceed.setAttribute('tabindex','-1');

      submitBtn.classList.add('is-disabled');
      submitBtn.disabled = true;
    }
  }

  function animateProgress(container, doneCb){
    const prog = container.querySelector('.progress');
    const bar  = container.querySelector('.bar');
    const pct  = container.querySelector('[data-pct]');
    prog.hidden = false;
    let p = 0;
    const tick = () => {
      p = Math.min(100, p + Math.random()*22);
      bar.style.width = p + '%';
      pct.textContent = Math.round(p) + '%';
      if(p < 100) {
        requestAnimationFrame(tick);
      } else {
        setTimeout(()=>{ prog.hidden = true; doneCb && doneCb(); }, 200);
      }
    };
    tick();
  }

  function simulateUpload(row, files){
    if(!files || !files.length) return;
    for(const f of files){
      if(tooBig(f)){
        alert(`"${f.name}" exceeds ${MAX_MB} MB. Please upload a smaller file.`);
        return;
      }
    }

    const dz = row.querySelector('[data-dropzone]');
    const input = dz.querySelector('input[type="file"]');
    const uploadBtn = dz.querySelector('.upload-btn');
    const uploading = dz.querySelector('.status-badge.warn');
    const uploaded  = dz.querySelector('.status-badge.ok');

    uploading.hidden = false;
    uploadBtn.disabled = true;

    animateProgress(dz, ()=>{
      row.dataset.completed = 'true';
      row.querySelector('input[type="checkbox"]').checked = true;
      setRowFiles(row, files);

      input.disabled = true;
      uploadBtn.hidden = true;

      uploading.hidden = true;
      uploaded.hidden = false;

      ensureActionButtons(row);
      updateProceedState();
    });
  }

  function wireRows(){
    document.querySelectorAll('#timelyBody tr').forEach(row=>{
      const dz = row.querySelector('[data-dropzone]');
      const input = dz.querySelector('input[type="file"]');
      const fnEl = dz.querySelector('[data-fn]');
      const uploadBtn = dz.querySelector('.upload-btn');

      input.addEventListener('change', ()=>{
        if(input.files && input.files.length){
          const files = Array.from(input.files).map(f=>f.name).join(', ');
          fnEl.textContent = files;
          uploadBtn.hidden = false;
          uploadBtn.disabled = false;
        }else{
          fnEl.textContent = 'None chosen';
          uploadBtn.hidden = true;
        }
      });

      uploadBtn.addEventListener('click', ()=>{
        if(input.files && input.files.length){
          simulateUpload(row, input.files);
        }
      });

      ['dragenter','dragover'].forEach(ev=>{
        dz.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dz.classList.add('dragover'); });
      });
      ['dragleave','drop'].forEach(ev=>{
        dz.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dz.classList.remove('dragover'); });
      });

      dz.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dz.classList.remove('dragover');
        const dt = e.dataTransfer;
        if (!dt || !dt.files || !dt.files.length) return;
        const picked = input.multiple ? Array.from(dt.files) : [dt.files[0]];
        fnEl.textContent = picked.map(f => f.name).join(', ');
        simulateUpload(row, picked);
      });
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateRowVisualRequiredness();
    updateProceedState();
    wireRows();

    const proceed = document.getElementById('proceedAction');
    if (proceed) {
      proceed.addEventListener('click', (e) => {
        if (proceed.classList.contains('is-disabled')) e.preventDefault();
      });
    }

    const submitBtn = document.getElementById('submitAll');
    if (submitBtn) {
      submitBtn.addEventListener('click', () => {
        const rows = Array.from(document.querySelectorAll('#timelyBody tr'));
        const payload = rows
          .filter(r => r.dataset.completed === 'true')
          .map(r => ({
            requirement: r.dataset.req,
            files: (r._uploadedFiles || []).map(f => ({
              name: f.name, size: f.size, type: f.type
            }))
          }));
        console.log('Submitting payload:', payload);
        alert('Submitted! We received ' + payload.reduce((n, r) => n + r.files.length, 0) + ' file(s).');
      });
    }

    const statusEl = document.getElementById('status');
    if (statusEl) {
      statusEl.addEventListener('change', () => {
        updateRowVisualRequiredness();
        updateProceedState();
      });
    }

    (function setToday(){
      const el = document.getElementById('todayDate');
      if(!el) return;
      const d = new Date();
      const txt = d.toLocaleDateString(undefined, {year:'numeric', month:'long', day:'numeric'});
      el.textContent = txt;
    })();
  });

  /* ==== Lightweight signature pad (mouse + touch) ==== */
  function makeSigPad(canvasId, imgId){
    const canvas = document.getElementById(canvasId);
    const img    = document.getElementById(imgId);
    if(!canvas) return;

    const ctx = canvas.getContext('2d');
    function fitCanvas(){
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width  = Math.floor(rect.width * ratio);
      canvas.height = Math.floor(rect.height * ratio);
      ctx.scale(ratio, ratio);
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#0f172a';
    }
    fitCanvas();
    window.addEventListener('resize', () => { 
      const data = canvas.toDataURL();
      fitCanvas();
      const imgTmp = new Image();
      imgTmp.onload = () => ctx.drawImage(imgTmp, 0, 0, canvas.clientWidth, canvas.clientHeight);
      imgTmp.src = data;
    });

    let drawing = false, last = null;
    function posFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      if(e.touches && e.touches[0]){
        return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
      }else{
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }
    }
    function start(e){ drawing = true; last = posFromEvent(e); e.preventDefault(); }
    function move(e){
      if(!drawing) return;
      const p = posFromEvent(e);
      ctx.beginPath();
      ctx.moveTo(last.x, last.y);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      last = p;
      e.preventDefault();
      img.src = canvas.toDataURL('image/png');
    }
    function end(){ drawing = false; last = null; }

    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', move);
    window.addEventListener('mouseup', end);

    canvas.addEventListener('touchstart', start, {passive:false});
    canvas.addEventListener('touchmove', move, {passive:false});
    canvas.addEventListener('touchend', end);

    return {
      clear(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        img.removeAttribute('src');
      },
      accept(){
        img.src = canvas.toDataURL('image/png');
      }
    };
  }

  const jo = makeSigPad('sigPad-joanne', 'sigImg-joanne');
  const te = makeSigPad('sigPad-teresita', 'sigImg-teresita');

  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const who = btn.getAttribute('data-clear');
      if(who === 'joanne') jo && jo.clear();
      if(who === 'teresita') te && te.clear();
    });
  });
  document.querySelectorAll('[data-accept]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const who = btn.getAttribute('data-accept');
      if(who === 'joanne') jo && jo.accept();
      if(who === 'teresita') te && te.accept();
    });
  });
</script>

</body>
</html>
